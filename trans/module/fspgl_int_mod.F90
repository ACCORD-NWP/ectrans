MODULE FSPGL_INT_MOD
CONTAINS
SUBROUTINE FSPGL_INT(KM,KMLOC,FSPGL_PROC)

#include "tsmbkind.h"

USE TPM_DIM
USE TPM_TRANS
USE TPM_GEOMETRY
USE TPM_DISTR

IMPLICIT NONE

INTEGER_M, INTENT(IN) :: KM
INTEGER_M, INTENT(IN) :: KMLOC
EXTERNAL  FSPGL_PROC

REAL_B :: ZFIELD(2*NF_OUT_LT,R%NDGL)


INTEGER_M :: ISL, IGLS, JFLD, JGL ,IPROC, ISTAN, IPROCS, ISTAS
INTEGER_M :: IPTRVOR,IPTRDIV,IPTRU,IPTRV,IPTRSC,IPTRNSD,IST
INTEGER_M :: IDGNH,IDGL
INTEGER_M :: ISTAN(R%NDGNH),ISTAS(R%NDGNH)

!     ------------------------------------------------------------------

ISL = MAX(R%NDGNH-G%NDGLU(KM)+1,1)
IDGNH = R%NDGNH
IDGL = R%NDGL
DO JGL=ISL,IDGNH
  IPROC = D%NPROCL(JGL)
  ISTAN(JGL) = (D%NSTAGT0B(IPROC) + D%NPNTGTB1(KMLOC,JGL))*2*NF_OUT_LT
  IGLS = IDGL+1-JGL
  IPROCS = D%NPROCL(IGLS)
  ISTAS(JGL) = (D%NSTAGT0B(IPROCS) + D%NPNTGTB1(KMLOC,IGLS))*2*NF_OUT_LT
ENDDO

DO JGL=ISL,IDGNH
  IGLS = IDGL+1-JGL
  DO JFLD=1,2*NF_OUT_LT
    ZFIELD(JFLD,JGL)  = FOUBUF_IN(ISTAN(JGL)+JFLD)
    ZFIELD(JFLD,IGLS) = FOUBUF_IN(ISTAS(JGL)+JFLD)
  ENDDO
ENDDO

IPTRVOR = -99
IPTRDIV = -99
IST = 1
IF(LVORGP) THEN
  IPTRVOR = IST
  IST = IST+2*NF_UV
ENDIF
IF(LDIVGP) THEN
  IPTRDIV = IST
  IST = IST+2*NF_UV
ENDIF
IPTRU = IST
IST = IST+2*NF_UV
IPTRV = IST
IST = IST+2*NF_UV
IPTRSC = IST
IST = IST+2*NF_SCALARS
IPTRNSD = IST
IST = IST+2*NF_SCDERS



CALL FSPGL_PROC(KM,KMLOC,ISL,IDGL,NF_OUT_LT,ZFIELD,&
 & IPTRVOR,IPTRDIV,IPTRU,IPTRV,IPTRSC,IPTRNSD,NF_UV,NF_SCALARS,NF_SCDERS)

DO JGL=ISL,IDGNH
  IGLS = IDGL+1-JGL
!OCL      NOVREC
  DO JFLD=1,2*NF_OUT_LT
    FOUBUF_IN(ISTAN(JGL)+JFLD) = ZFIELD(JFLD,JGL)
    FOUBUF_IN(ISTAS(JGL)+JFLD) = ZFIELD(JFLD,IGLS)
  ENDDO
ENDDO

!     ------------------------------------------------------------------

END SUBROUTINE FSPGL_INT
END MODULE FSPGL_INT_MOD

